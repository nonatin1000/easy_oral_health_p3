{% extends "base.html" %}

{% block body %}

<nav class="navbar navbar-default">
	<div class="container">
		<!-- Form Search -->
		<form class="navbar-form navbar-left" action="." method="get">
			<div class="form-group">
				<input id="search_box" name="search_box" type="text" placeholder="Nome do Paciente..." class="form-control" autofocus="true">
			</div>
			<div class="form-group">
				<button type="submit" class="btn btn-default form-control" title="Clique para realizar a pesquisar">
					<span class="glyphicon glyphicon-search"></span>
				</button>
			</div>
		</form>
		<!-- Fim form Search -->
		<ul class="nav navbar-nav pull-right">
			<li>
				<p class="navbar-btn">
					<a class="btn btn-default" href="{% url 'patient_register' %}"> 
						<span class="glyphicon glyphicon-file" aria-hidden="true"></span>
						Novo
					</a>
				</p>
			</li>
		</ul>
	</div>
</nav>

<div class="container">
	<div class="row">
		<div class="col-lg-12">
			<table class="table table-hover">
				<thead>
					<tr>
						<th>Nome</th>
						<th>Telefone</th>
						<th style="width: 150px;">Ações</th>
					</tr>
				</thead>
				<tbody>
					{% for patient in patients %}

					{% if patient.types != 'Dependente' %}
					<tr>
						<td>{{ patient.name }}</td>
						<td>{{ patient.phone }}</td>
						<td>
							{% if dependent.id == patient.id %}
							<a href="#" class="btn btn-success" title= "Selecionar paciente">
								<span class="glyphicon glyphicon-check" aria-hidden="true"></span>
							</a>
							{% else %}
							<a href="#" class="btn btn-default" titl="Selecionar paciente">
								<span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span>
							</a>
							{% endif %} 
							<a href="{% url 'patient_show' patient.id %}" class="btn btn-default" title="Exibir">
								<span class="glyphicon glyphicon-search" aria-hidden="true"></span>
							</a>
							{% if patient.types != 'Estudante' %}
								<a href="{% url 'dependent_register' patient.id %}" class="btn btn-default" title="Add Dependente">
									<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
								</a>
							{% endif %}
						</td>
					</tr>
					{% endif %}
					<!-- SE TIVER DEPENDENTES LISTA ELES AQUI... -->
					
					{% if patient.dependents.count > 0 %}
					<tr>
						<td colspan="4">
							<div class="panel panel-success">
								<div class="panel-heading">
									<h3 class="panel-title">Dependentes</h3>
								</div>
								<div class="panel-body">
									
									<table style="width:100%;">
										<thead>
											<tr>
												<th>Nome</th>
												<th>Email</th>
												<th>Fone</th>
												<th style="width: 5%;">Ações</th>
											</tr>
										</thead>
										<tbody>
											{% for dependent in patient.dependents.all %}
											<tr>
												<input type="hidden" name="types" id="types" value="DEPENDENT"></td>
												<td>{{ dependent.name }}</td>
												<td>{{ dependent.email }}</td>
												<td>{{ dependent.phone }}</td>
												<td> 
													<a href="{% url 'patient_show' dependent.id %}" class="btn btn-default" title="Exibir">
														<span class="glyphicon glyphicon-search" aria-hidden="true"></span>
													</a>     
												</td>
											</tr>
											{% endfor %}

										</tbody>
									</table>
								</td>
							</tr>
						</div>
					</div>
					{% endif %}
					<!-- DEPENDENTES... -->

					
					{% endfor %}
				</tbody>
			</table>
			<center>
				<!-- Paginação -->
				{% if patients.has_other_pages %}
				<nav>
					<ul class="pagination">
						{% if patients.has_previous %}
						<li>
							<a href="?page={{ patients.previous_page_number }}" aria-label="Previous">
								<span aria-hidden="true">&laquo;</span>
							</a>
						</li>
						{% else %}
						<li class="disabled"><a href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
						{% endif %}
						{% for page_num in patients.paginator.page_range %}
						<li {% if page_num == patients.number %} class="active" {% endif %}>
							<a href="?page={{ page_num }}">{{ page_num }}</a>
						</li>
						{% endfor %}
						{% if patients.has_next %}
						<li>
							<a href="?page={{ patients.next_page_number}}" aria-label="Next">
								<span aria-hidden="true">&raquo;</span>
							</a>
						</li>
						{% else %}
						<li class="disabled">
							<a href="#" aria-label="Next">
								<span aria-hidden="true">&raquo;</span>
							</a>
						</li>
						{% endif %}
					</ul>
				</nav>
				{% endif %}
				<!-- Fim da Paginação -->
			</center>
		</div>
	</div>
</div>
</div>

{% endblock %}
